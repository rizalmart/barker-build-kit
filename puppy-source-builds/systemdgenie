#!/bin/bash

echo "Installing build dependencies for Qt6/KF6..."
apt install -y qt6-base-dev qt6-tools-dev qt6-tools-dev-tools \
  libkf6coreaddons-dev libkf6i18n-dev libkf6config-dev \
  libkf6widgetsaddons-dev libkf6iconthemes-dev \
  libkf6windowsystem-dev libkf6notifications-dev \
  libkf6auth-dev libkf6crash-dev libkf6texteditor-dev \
  libkf6kio-dev

cd /tmp

WORKDIR=$(mktemp -d)

cd "$WORKDIR"

echo "Downloading sources..."

# gtkdialog (main branch)
wget -O systemdgenie.zip \
  https://github.com/KDE/systemdgenie/archive/refs/heads/master.zip

echo "Extracting..."
unzip systemdgenie.zip

cd systemdgenie-master

echo "Creating build directory..."
mkdir -p build
cd build

echo "Configuring with CMake for Qt6/KF6 with /usr/local prefix..."
cmake .. -DCMAKE_BUILD_TYPE=Release -DCMAKE_INSTALL_PREFIX=/usr/local

echo "Building..."
make -j"$(nproc)"

echo "Installing to /usr/local..."
make install

echo "Build and install complete in /usr/local."

cd /tmp

#rm -rf ${WORKDIR}
